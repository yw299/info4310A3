<!DOCTYPE html>
<head>

  <title>Homework 3</title>
  <meta charset="utf-8" />
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/d3-collection.v1.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>

  <style>
  select {
        display: block;
        background-color: #E5E5E5;
        border-color: #F9B806;
        font-size:20px;
        border-radius: 5px;
        border-width: 5px;
        /* margin:20px; */
        padding:10px;
    }

  #button{
        margin-top: -20px;
        margin-left:40px;
    }
  .neighborhood {
    fill: #f9f9f9;
    stroke: #bdbdbd;
    stroke-width: 1px;
  }

  </style>

</head>

<body>

  <h1>Pittsburgh Restaurant Reviews</h1>

  <svg id="map" width="1200" height="900"></svg>


<p>Choose restaurant category</p>
<div class="category">
  <input type="checkbox" name="active" value="active">
  <label for="active">Active</label>
</div>
<div class="category">
  <input type="checkbox" name="arts" value="arts">
  <label for="arts">Arts</label>
</div>
<div class="category">
  <input type="checkbox" name="bakeries" value="bakeries">
  <label for="bakeries">Bakeries</label>
</div>
<div class="category">
  <input type="checkbox" name="cafes" value="cafes">
  <label for="cafes">Cafes</label>
</div>
<div class="category">
  <input type="checkbox" name="chinese" value="chinese">
  <label for="chinese">Chinese</label>
</div>
<div class="category">
  <input type="checkbox" name="coffee" value="coffee">
  <label for="coffee">Coffee</label>
</div>
<div class="category">
  <input type="checkbox" name="donuts" value="donuts">
  <label for="donuts">Donuts</label>
</div>
<div class="category">
  <input type="checkbox" name="ethnicmarkets" value="ethnicmarkets">
  <label for="ethnicmarkets">Ethnicmarkets</label>
</div>
<div class="category">
  <input type="checkbox" name="french" value="french">
  <label for="french">French</label>
</div>
<div class="category">
  <input type="checkbox" name="indpak" value="indpak">
  <label for="indpak">Indpak</label>
</div>
<div class="category">
  <input type="checkbox" name="italian" value="italian">
  <label for="italian">Italian</label>
</div>
<div class="category">
  <input type="checkbox" name="japanese" value="japanese">
  <label for="japanese">Japanese</label>
</div>
<div class="category">
  <input type="checkbox" name="mexican" value="mexican">
  <label for="mexican">Mexican</label>
</div>
<div class="category">
  <input type="checkbox" name="newamerican" value="newamerican">
  <label for="newamerican">NewAmerican</label>
</div>
<div class="category">
  <input type="checkbox" name="nightlife" value="nightlife">
  <label for="nightlife">Nightlife</label>
</div>
<div class="category">
  <input type="checkbox" name="pizza" value="pizza">
  <label for="pizza">Pizza</label>
</div>
<div class="category">
  <input type="checkbox" name="restaurant" value="restaurant">
  <label for="restaurant">Resturant</label>
</div>
<div class="category">
  <input type="checkbox" name="sandwiches" value="sandwiches">
  <label for="sandwiches">Sandwiches</label>
</div>
<div class="category">
  <input type="checkbox" name="shopping" value="shopping">
  <label for="shopping">Shopping</label>
</div>
<div class="category">
  <input type="checkbox" name="sushi" value="sushi">
  <label for="sushi">Sushi</label>
</div>
<div class="category">
  <input type="checkbox" name="thai" value="thai">
  <label for="thai">Thai</label>
</div>
<div class="category">
  <input type="checkbox" name="vietnamese" value="vietnamese">
  <label for="vietnamese">Vietnamese</label>
</div>

  <script id="code">

    // Map & Dimensions
    const map = d3.select("svg#map");
    const mapWidth = map.attr("width");
    const mapHeight = map.attr("height");
    const chartArea = map.append("g");


    // RequestData function
    const requestData = async function() {


      // Loading data
      const pittsData = await d3.json("pittsburgh_neighborhoods.json");
      const yelpData = await d3.csv("yelp_pittsburgh.csv");

      // DELETE LATER
      console.log(pittsData);
      console.log(yelpData);

      // Map Projection
      var pitts = topojson.feature(pittsData, pittsData.objects.Neighborhoods_);
      var pittsProjection = d3.geoMercator().fitSize([mapWidth, mapHeight], pitts);
      var pittsPath = d3.geoPath().projection(pittsProjection);

      // Restaurant position
      yelpData.forEach( d => {
        d.Position = pittsProjection( [d.longitude, d.latitude]);
      });

      console.log(yelpData);

      // Drawing Map Projection
      chartArea.selectAll("path.neighborhood").data(pitts.features)
          .join("path")
          .attr("class", "neighborhood")
          .attr("d", pittsPath);

      // Drawing Resturant Positions
      let circles=chartArea.selectAll("circle").data(yelpData)
        .join("circle")
        .attr("r", 5)
        .attr("fill", "orange")
        .attr("opacity", 0.5)
        .attr("cx", d => d.Position[0])
        .attr("cy", d => d.Position[1]);


        //zoom
        let zoomExtent = [[0,0],[mapWidth,mapHeight]];
        let translateExtent = [[-100,-100],[mapWidth+100,mapHeight+100]];
        var plotZoom = d3.zoom()
                       .extent(zoomExtent)
                       .translateExtent(translateExtent)
                       .scaleExtent([1,8])
                       .on("zoom", plotZoomed);

       // make an interactive "surface" at the top of the plot area
     map.append("rect").attr("x",0).attr("y",0)
                        .attr("width",mapWidth).attr("height",mapHeight)
                        .attr("fill","none")
                        .style("pointer-events","all");
     // then add the zoom handler
    map.call(plotZoom);


           function plotZoomed( evt ) {

          let transform = evt.transform;
          //
          chartArea.attr("transform", transform);
          //
          //
          //
          // // adjust circle size too
          circles.attr("r", 6 / transform.k);


        }





        map.call(plotZoom.transform, d3.zoomIdentity);


    };




    // RequestData call

    requestData();

  </script>

</body>

</html>
